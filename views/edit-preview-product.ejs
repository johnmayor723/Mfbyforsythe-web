<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">Mfbyforesythebrand</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="#">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Products</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Orders</a></li>
      </ul>
    </div>
  </div>
</nav>

<!-- Product Form -->
<div class="container mt-4">
  <h2>Edit Product Draft</h2>
  <form action="/management/preview/<%= product._id %>?_method=PUT" method="POST" enctype="multipart/form-data">
    <!-- Name -->
    <div class="mb-3">
      <label class="form-label">Name:</label>
      <input type="text" class="form-control" name="name" value="<%= product.name %>" required>
    </div>

    <!-- Description -->
    <div class="mb-3">
      <label class="form-label">Description:</label>
      <textarea class="form-control" name="description" required><%= product.description %></textarea>
    </div>

    <!-- Sizes -->
    <div class="mb-3">
      <label class="form-label">Select Sizes:</label>
      <div class="d-flex flex-wrap gap-2">
        <% ['XS', 'S', 'M', 'L', 'XL', 'XXL', 'UK 6', 'UK 8', 'UK 10', 'UK 12', 'UK 14', 'UK 16', 'UK 18'].forEach(size => { %>
          <label>
            <input type="checkbox" name="size" value="<%= size %>" <%= product.size.includes(size) ? 'checked' : '' %>> <%= size %>
          </label>
        <% }); %>
      </div>
    </div>

    <!-- Price -->
    <div class="mb-3">
      <label class="form-label">Price:</label>
      <input type="number" class="form-control" name="price" value="<%= product.price %>" required>
    </div>

    <!-- Colors -->
    <div class="mb-3">
      <label class="form-label">Select Colors:</label>
      <div class="d-flex flex-wrap gap-2">
        <% ['Black', 'White', 'Red', 'Blue', 'Green', 'Yellow', 'Purple', 'Pink', 'Gray', 'Brown', 'Beige', 'Orange', 'Teal', 'Navy', 'Burgundy', 'Olive', 'Mustard', 'Lavender', 'Turquoise'].forEach(color => { %>
          <label>
            <input type="checkbox" name="colors" value="<%= color %>" <%= product.colors.includes(color) ? 'checked' : '' %>> <%= color %>
          </label>
        <% }); %>
      </div>
    </div>

    <!-- Upload New Images -->
    <div class="mb-3">
      <label class="form-label">Upload New Images:</label>
      <div id="imageUploads">
        <input type="file" class="form-control" name="images" accept="image/*" multiple>
      </div>
      <button type="button" class="btn btn-secondary mt-2" id="addImage">+ Add More Images</button>
    </div>

    <!-- Existing Images -->
    <div class="mb-3">
      <label class="form-label">Existing Images:</label>
      <div class="d-flex flex-wrap gap-2">
        <% if (product.images && product.images.length) { %>
          <% product.images.forEach(img => { %>
            <div class="text-center">
              <img src="<%= img %>" style="max-width: 100px;" class="img-thumbnail mb-1">
              <div>
                <input type="checkbox" name="keepImages" value="<%= img %>" checked> Keep
              </div>
            </div>
          <% }); %>
        <% } else { %>
          <p>No images uploaded.</p>
        <% } %>
      </div>
    </div>

    <!-- New Image Previews -->
    <div id="imagePreviews" class="mt-3 d-flex flex-wrap gap-2"></div>

    <button type="submit" class="btn btn-primary">Update Product</button>
  </form>
</div>

<!-- Image Preview Script -->
<script>
  function createPreview(file) {
    const reader = new FileReader();
    reader.onload = function (e) {
      const img = document.createElement('img');
      img.src = e.target.result;
      img.style.maxWidth = '150px';
      img.style.maxHeight = '150px';
      img.classList.add('img-thumbnail');
      document.getElementById('imagePreviews').appendChild(img);
    };
    reader.readAsDataURL(file);
  }

  document.querySelector('#imageUploads input[type="file"]').addEventListener('change', function () {
    document.getElementById('imagePreviews').innerHTML = '';
    for (let file of this.files) {
      createPreview(file);
    }
  });

  document.getElementById('addImage').addEventListener('click', function () {
    const imageUploads = document.getElementById('imageUploads');
    const newInput = document.createElement('input');
    newInput.type = 'file';
    newInput.name = 'images';
    newInput.accept = 'image/*';
    newInput.classList.add('form-control', 'mt-2');

    newInput.addEventListener('change', function () {
      for (let file of this.files) {
        createPreview(file);
      }
    });

    imageUploads.appendChild(newInput);
  });
</script>
